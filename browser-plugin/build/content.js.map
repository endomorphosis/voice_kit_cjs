{"version":3,"file":"content.js","mappings":"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","sources":["webpack://browser-extension/./src/content.js"],"sourcesContent":["// content.js - runs in page context with safe document handling\r\n(() => {\r\n  const state = {\r\n    elements: new Map(),\r\n    isInitialized: false\r\n  };\r\n\r\n  // Safe document access\r\n  const whenDocumentReady = () => new Promise(resolve => {\r\n    if (!document || document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', () => resolve(document));\r\n    } else {\r\n      resolve(document);\r\n    }\r\n  });\r\n\r\n  // Safe string handling\r\n  const safeString = input => input == null ? '' : String(input);\r\n\r\n  // Safe element creation\r\n  const createUIElement = (id, config) => {\r\n    try {\r\n      const element = document.createElement(config.tag || 'div');\r\n      element.id = id;\r\n      \r\n      if (config.text) {\r\n        element.textContent = safeString(config.text);\r\n      }\r\n      \r\n      if (config.styles) {\r\n        Object.assign(element.style, config.styles);\r\n      }\r\n      \r\n      if (config.parent) {\r\n        config.parent.appendChild(element);\r\n      }\r\n      \r\n      state.elements.set(id, element);\r\n      return element;\r\n    } catch (error) {\r\n      console.error('Failed to create UI element:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Initialize content script safely\r\n  async function initializeContent() {\r\n    try {\r\n      await whenDocumentReady();\r\n      if (state.isInitialized) return;\r\n      \r\n      // WebGPU support check\r\n      const hasWebGPU = await checkWebGPU();\r\n      console.log('WebGPU support:', hasWebGPU);\r\n      \r\n      // Message handling\r\n      chrome.runtime.onMessage.addListener((message) => {\r\n        if (!message || typeof message !== 'object') return;\r\n        \r\n        try {\r\n          switch (message.action) {\r\n            case 'showLoading':\r\n              showLoading();\r\n              break;\r\n            case 'hideLoading':\r\n              hideLoading();\r\n              break;\r\n            case 'showResult':\r\n              showResult(message);\r\n              break;\r\n            case 'showError':\r\n              showError(message.error);\r\n              break;\r\n          }\r\n        } catch (error) {\r\n          console.error('Error handling message:', error);\r\n          showError(error.message);\r\n        }\r\n      });\r\n\r\n      state.isInitialized = true;\r\n    } catch (error) {\r\n      console.error('Content script initialization failed:', error);\r\n    }\r\n  }\r\n\r\n  // Utility functions with proper error handling\r\n  async function checkWebGPU() {\r\n    if (!navigator.gpu) return false;\r\n    try {\r\n      const adapter = await navigator.gpu.requestAdapter();\r\n      return !!adapter;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function showLoading() {\r\n    createUIElement('extension-loading', {\r\n      text: 'Fetching content...',\r\n      styles: {\r\n        position: 'fixed',\r\n        top: '20px',\r\n        right: '20px',\r\n        padding: '10px',\r\n        background: 'white',\r\n        border: '1px solid #ccc',\r\n        borderRadius: '4px',\r\n        zIndex: '10000'\r\n      },\r\n      parent: document.body\r\n    });\r\n  }\r\n\r\n  function hideLoading() {\r\n    const element = state.elements.get('extension-loading');\r\n    if (element?.parentNode) {\r\n      element.parentNode.removeChild(element);\r\n      state.elements.delete('extension-loading');\r\n    }\r\n  }\r\n\r\n  function showResult({ result, userText }) {\r\n    const container = createUIElement('copilot-chat-container', {\r\n      styles: {\r\n        position: 'fixed',\r\n        top: '20px',\r\n        right: '20px',\r\n        width: '400px',\r\n        maxHeight: '80vh',\r\n        background: 'white',\r\n        border: '1px solid #ccc',\r\n        borderRadius: '8px',\r\n        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',\r\n        zIndex: '10000',\r\n        display: 'flex',\r\n        flexDirection: 'column'\r\n      },\r\n      parent: document.body\r\n    });\r\n\r\n    if (!container) return;\r\n\r\n    const header = createUIElement('chat-header', {\r\n      styles: {\r\n        padding: '12px',\r\n        borderBottom: '1px solid #eee',\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center'\r\n      },\r\n      parent: container\r\n    });\r\n\r\n    createUIElement('chat-title', {\r\n      tag: 'span',\r\n      text: 'AI Response',\r\n      styles: {\r\n        fontWeight: 'bold'\r\n      },\r\n      parent: header\r\n    });\r\n\r\n    const closeBtn = createUIElement('chat-close', {\r\n      tag: 'button',\r\n      text: 'Ã—',\r\n      styles: {\r\n        border: 'none',\r\n        background: 'none',\r\n        cursor: 'pointer',\r\n        fontSize: '20px',\r\n        padding: '0 4px'\r\n      },\r\n      parent: header\r\n    });\r\n\r\n    if (closeBtn) {\r\n      closeBtn.onclick = () => {\r\n        container.remove();\r\n        state.elements.clear();\r\n      };\r\n    }\r\n\r\n    const content = createUIElement('chat-content', {\r\n      styles: {\r\n        padding: '16px',\r\n        overflowY: 'auto',\r\n        fontSize: '14px',\r\n        lineHeight: '1.5'\r\n      },\r\n      parent: container\r\n    });\r\n\r\n    if (content) {\r\n      createUIElement('user-message', {\r\n        text: userText,\r\n        styles: {\r\n          marginBottom: '12px',\r\n          padding: '8px 12px',\r\n          background: '#f0f0f0',\r\n          borderRadius: '8px'\r\n        },\r\n        parent: content\r\n      });\r\n\r\n      createUIElement('ai-response', {\r\n        text: result,\r\n        styles: {\r\n          padding: '8px 12px',\r\n          background: '#e3f2fd',\r\n          borderRadius: '8px',\r\n          whiteSpace: 'pre-wrap'\r\n        },\r\n        parent: content\r\n      });\r\n    }\r\n  }\r\n\r\n  function showError(error) {\r\n    const errorText = safeString(error || 'Unknown error occurred');\r\n    alert(errorText);\r\n  }\r\n\r\n  // Start initialization\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', initializeContent);\r\n  } else {\r\n    initializeContent();\r\n  }\r\n})();\r\n\r\nfunction handleTranscription(text) {\r\n  // Only modify the page if we have access to the document\r\n  if (document && document.body) {\r\n    // Handle the transcription result\r\n    console.log('Received transcription:', text);\r\n  }\r\n}\r\n\r\n// Send audio data to background script\r\nfunction sendAudioData(audioData) {\r\n  chrome.runtime.sendMessage({\r\n    type: 'transcribe',\r\n    audio: audioData\r\n  });\r\n}\r\n\r\n// Example usage for text generation:\r\n//\r\n// import { ACTION_NAME } from \"./constants.js\";\r\n// const message = {\r\n//     action: ACTION_NAME,\r\n//     text: 'Your input text here',\r\n// }\r\n// const response = await chrome.runtime.sendMessage(message);\r\n// console.log('Generated text:', response)\r\n\r\n// You can also add your own UI elements or handlers here to trigger text generation\r\n// The context menu integration is handled by background.js\r\n"],"names":["state","elements","Map","isInitialized","whenDocumentReady","Promise","resolve","document","readyState","addEventListener","safeString","input","String","createUIElement","id","config","element","createElement","tag","text","textContent","styles","Object","assign","style","parent","appendChild","set","error","console","initializeContent","hasWebGPU","checkWebGPU","log","chrome","runtime","onMessage","addListener","message","action","showLoading","hideLoading","showResult","showError","navigator","gpu","adapter","requestAdapter","position","top","right","padding","background","border","borderRadius","zIndex","body","get","parentNode","removeChild","delete","result","userText","container","width","maxHeight","boxShadow","display","flexDirection","header","borderBottom","justifyContent","alignItems","fontWeight","closeBtn","cursor","fontSize","onclick","remove","clear","content","overflowY","lineHeight","marginBottom","whiteSpace","errorText","alert","handleTranscription","sendAudioData","audioData","sendMessage","type","audio"],"sourceRoot":""}