{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://browser-extension/./src/popup.js"],"sourcesContent":["// popup.js - handles interaction with the extension's popup UI\r\n\r\n// Global state management\r\nconst state = {\r\n  isConnected: false,\r\n  reconnectAttempts: 0,\r\n  mediaRecorder: null,\r\n  audioChunks: [],\r\n  worker: null,\r\n  elements: null,\r\n  recording: false,\r\n  wasmPath: chrome.runtime.getURL('wasm/'),\r\n  audioContext: null,\r\n  audioWorklet: null\r\n};\r\n\r\n// String handling utilities\r\nconst safeString = input => {\r\n  if (input === null || input === undefined) return '';\r\n  return String(input);\r\n};\r\n\r\n// Safe DOM access after ensuring document is ready\r\nconst documentReady = () => new Promise(resolve => {\r\n  if (!document || document.readyState === 'loading') {\r\n    window.addEventListener('DOMContentLoaded', () => resolve(document));\r\n  } else {\r\n    resolve(document);\r\n  }\r\n});\r\n\r\n// Initialize UI only after document is ready\r\nasync function initializeUI() {\r\n  const doc = await documentReady();\r\n  \r\n  try {\r\n    state.elements = {\r\n      chatInput: doc.getElementById('chat-input'),\r\n      sendButton: doc.getElementById('send-button'),\r\n      chatMessages: doc.getElementById('chat-messages'),\r\n      recordButton: doc.getElementById('recordButton'),\r\n      statusDiv: doc.getElementById('status'),\r\n      transcriptionDiv: doc.getElementById('transcriptionDiv'),\r\n      logMessages: doc.getElementById('log-messages')\r\n    };\r\n\r\n    // Validate all elements exist\r\n    const missingElements = Object.entries(state.elements)\r\n      .filter(([_, value]) => !value)\r\n      .map(([key]) => key);\r\n\r\n    if (missingElements.length > 0) {\r\n      throw new Error(`Missing UI elements: ${JSON.stringify(missingElements)}`);\r\n    }\r\n\r\n    // Add event listeners with error handling\r\n    state.elements.recordButton?.addEventListener('click', handleRecordClick);\r\n    state.elements.sendButton?.addEventListener('click', handleSendClick);\r\n    state.elements.chatInput?.addEventListener('input', handleInputChange);\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('UI initialization failed:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Event handlers with proper error handling\r\nfunction handleRecordClick() {\r\n  if (!state.elements?.recordButton) return;\r\n  toggleRecording().catch(error => {\r\n    console.error('Recording error:', error);\r\n    updateStatus(`Error: ${safeString(error.message)}`);\r\n  });\r\n}\r\n\r\nfunction handleSendClick() {\r\n  if (!state.elements?.chatInput) return;\r\n  const text = state.elements.chatInput.value.trim();\r\n  if (!text) return;\r\n  \r\n  sendMessage(text).catch(error => {\r\n    console.error('Send error:', error);\r\n    addMessage(`Error: ${safeString(error.message)}`, false);\r\n  });\r\n}\r\n\r\nfunction handleInputChange() {\r\n  if (!state.elements?.sendButton || !state.elements?.chatInput) return;\r\n  state.elements.sendButton.disabled = !state.elements.chatInput.value.trim();\r\n}\r\n\r\n// Console logging with safe string handling\r\nfunction addLogEntry(type, ...args) {\r\n  if (!state.elements?.logMessages) return;\r\n  \r\n  const entry = document.createElement('div');\r\n  entry.className = `log-entry ${type}`;\r\n  \r\n  const safeArgs = args.map(arg => {\r\n    if (arg === null) return 'null';\r\n    if (arg === undefined) return 'undefined';\r\n    if (typeof arg === 'object') {\r\n      try {\r\n        return JSON.stringify(arg);\r\n      } catch {\r\n        return '[Object]';\r\n      }\r\n    }\r\n    return safeString(arg);\r\n  });\r\n  \r\n  entry.textContent = safeArgs.join(' ');\r\n  state.elements.logMessages.appendChild(entry);\r\n  state.elements.logMessages.scrollTo(0, state.elements.logMessages.scrollHeight);\r\n}\r\n\r\n// Initialize after DOM is ready\r\ndocumentReady().then(() => {\r\n  console.log('Initializing popup...');\r\n  initializeUI()\r\n    .then(() => Promise.all([\r\n      initASR(),\r\n      checkConnection()\r\n    ]))\r\n    .then(() => {\r\n      console.log('Initialization complete');\r\n      checkModelStatus();\r\n    })\r\n    .catch(error => {\r\n      console.error('Initialization failed:', error);\r\n      addLogEntry('error', 'Failed to initialize:', error.message);\r\n    });\r\n});\r\n\r\n// Clean up\r\nwindow.addEventListener('unload', cleanup);\r\n\r\n// Message handling\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  if (!message || typeof message !== 'object') return;\r\n\r\n  const { type, text, error } = message;\r\n  \r\n  switch (type) {\r\n    case 'transcription':\r\n      if (text) updateTranscription(text);\r\n      break;\r\n    case 'error':\r\n      updateStatus(`Error: ${safeString(error)}`);\r\n      break;\r\n  }\r\n});\r\n\r\n// Override console methods for logging\r\nconst originalConsole = {\r\n  log: console.log,\r\n  error: console.error,\r\n  info: console.info\r\n};\r\n\r\nconsole.log = (...args) => {\r\n  addLogEntry('info', ...args);\r\n  originalConsole.log(...args);\r\n};\r\n\r\nconsole.error = (...args) => {\r\n  addLogEntry('error', ...args);\r\n  originalConsole.error(...args);\r\n};\r\n\r\nconsole.info = (...args) => {\r\n  addLogEntry('info', ...args);\r\n  originalConsole.info(...args);\r\n};\r\n\r\n// UI update functions\r\nfunction updateStatus(message) {\r\n  if (!state.elements?.statusDiv) return;\r\n  state.elements.statusDiv.textContent = safeString(message);\r\n}\r\n\r\nfunction updateTranscription(text) {\r\n  if (!state.elements?.transcriptionDiv || !state.elements?.chatInput) return;\r\n  const safeText = safeString(text);\r\n  state.elements.transcriptionDiv.textContent = safeText;\r\n  const currentInput = state.elements.chatInput.value;\r\n  state.elements.chatInput.value = currentInput ? `${currentInput.trim()} ${safeText}` : safeText;\r\n}\r\n\r\nfunction addMessage(content, isUser = false) {\r\n  if (!state.elements?.chatMessages || !content) return;\r\n  const messageDiv = document.createElement('div');\r\n  messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;\r\n  messageDiv.textContent = safeString(content);\r\n  state.elements.chatMessages.appendChild(messageDiv);\r\n  state.elements.chatMessages.scrollTo(0, state.elements.chatMessages.scrollHeight);\r\n}\r\n\r\n// ASR functionality with proper initialization\r\nasync function initASR() {\r\n  if (state.worker) {\r\n    console.log('ASR worker already initialized');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const workerURL = chrome.runtime.getURL('asr-worker.js');\r\n    \r\n    // Create worker with module support\r\n    state.worker = new Worker(workerURL, {\r\n      type: 'module',\r\n      name: 'asr-worker'\r\n    });\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => {\r\n        cleanupWorker();\r\n        reject(new Error('ASR worker initialization timed out'));\r\n      }, 30000);\r\n\r\n      state.worker.onmessage = (event) => {\r\n        const { type, text, error } = event.data;\r\n        switch (type) {\r\n          case 'ready':\r\n            clearTimeout(timeout);\r\n            enableMicButton();\r\n            resolve();\r\n            break;\r\n          case 'transcription':\r\n            if (text) updateTranscription(text);\r\n            break;\r\n          case 'error':\r\n            console.error('ASR error:', error);\r\n            addLogEntry('error', 'ASR error: ' + safeString(error));\r\n            updateStatus('ASR error: ' + safeString(error));\r\n            break;\r\n        }\r\n      };\r\n\r\n      state.worker.onerror = (error) => {\r\n        console.error('ASR worker error:', error);\r\n        addLogEntry('error', 'ASR worker error: ' + safeString(error.message));\r\n        clearTimeout(timeout);\r\n        cleanupWorker();\r\n        reject(error);\r\n      };\r\n\r\n      // Initialize worker with proper paths\r\n      state.worker.postMessage({\r\n        type: 'init',\r\n        wasmPath: state.wasmPath,\r\n        modelPath: chrome.runtime.getURL('models/')\r\n      });\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error initializing ASR:', error);\r\n    addLogEntry('error', 'Failed to initialize speech recognition: ' + safeString(error.message));\r\n    disableMicButton();\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Audio recording functionality with proper error handling\r\nasync function toggleRecording() {\r\n  try {\r\n    if (!state.mediaRecorder) {\r\n      // Request microphone access with proper error handling\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: {\r\n          channelCount: 1,\r\n          sampleRate: 16000,\r\n          autoGainControl: false,\r\n          noiseSuppression: false,\r\n          echoCancellation: false\r\n        }\r\n      }).catch(error => {\r\n        if (error.name === 'NotAllowedError') {\r\n          throw new Error('Microphone access denied. Please allow microphone access in your browser settings.');\r\n        }\r\n        throw error;\r\n      });\r\n\r\n      // Initialize audio context if needed\r\n      if (!state.audioContext) {\r\n        state.audioContext = new (window.AudioContext || window.webkitAudioContext)({\r\n          sampleRate: 16000\r\n        });\r\n      }\r\n\r\n      // Create media recorder with proper MIME type checking\r\n      const mimeType = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') \r\n        ? 'audio/webm;codecs=opus'\r\n        : 'audio/webm';\r\n\r\n      state.mediaRecorder = new MediaRecorder(stream, {\r\n        mimeType,\r\n        audioBitsPerSecond: 16000\r\n      });\r\n      \r\n      state.audioChunks = [];\r\n      \r\n      state.mediaRecorder.ondataavailable = async (event) => {\r\n        if (event.data.size > 0) {\r\n          state.audioChunks.push(event.data);\r\n        }\r\n      };\r\n\r\n      state.mediaRecorder.onstop = async () => {\r\n        try {\r\n          const audioBlob = new Blob(state.audioChunks, { type: mimeType });\r\n          \r\n          // Convert blob to Float32Array properly\r\n          const arrayBuffer = await audioBlob.arrayBuffer();\r\n          const audioBuffer = await state.audioContext.decodeAudioData(arrayBuffer);\r\n          const channelData = audioBuffer.getChannelData(0);\r\n          \r\n          // Ensure valid audio data\r\n          if (!channelData || channelData.length === 0) {\r\n            throw new Error('No audio data recorded');\r\n          }\r\n\r\n          // Validate audio data\r\n          if (channelData.some(x => !isFinite(x))) {\r\n            throw new Error('Invalid audio data detected');\r\n          }\r\n          \r\n          state.worker?.postMessage({\r\n            type: 'transcribe',\r\n            audio: channelData\r\n          });\r\n          \r\n          state.audioChunks = [];\r\n        } catch (error) {\r\n          console.error('Error processing audio:', error);\r\n          updateStatus(`Error processing audio: ${safeString(error.message)}`);\r\n        }\r\n      };\r\n\r\n      state.mediaRecorder.start(100); // Collect data every 100ms\r\n      state.elements.recordButton.querySelector('span').textContent = 'Stop';\r\n      updateStatus('Recording...');\r\n      \r\n      // Update UI\r\n      state.elements.recordButton.classList.add('recording');\r\n    } else {\r\n      state.mediaRecorder.stop();\r\n      const tracks = state.mediaRecorder.stream.getTracks();\r\n      tracks.forEach(track => track.stop());\r\n      state.mediaRecorder = null;\r\n      \r\n      // Update UI\r\n      state.elements.recordButton.querySelector('span').textContent = 'Record';\r\n      state.elements.recordButton.classList.remove('recording');\r\n      updateStatus('Processing...');\r\n    }\r\n  } catch (error) {\r\n    console.error('Recording error:', error);\r\n    const errorMessage = error.name === 'NotAllowedError' \r\n      ? 'Microphone access denied. Please allow microphone access.'\r\n      : `Recording error: ${error.message}`;\r\n    updateStatus(errorMessage);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Utility functions\r\nfunction cleanupWorker() {\r\n  if (state.worker) {\r\n    state.worker.terminate();\r\n    state.worker = null;\r\n  }\r\n}\r\n\r\nfunction enableMicButton() {\r\n  if (!state.elements?.recordButton) return;\r\n  state.elements.recordButton.disabled = false;\r\n}\r\n\r\nfunction disableMicButton() {\r\n  if (!state.elements?.recordButton) return;\r\n  state.elements.recordButton.disabled = true;\r\n}\r\n\r\nasync function checkConnection() {\r\n  try {\r\n    await chrome.runtime.sendMessage({ type: 'check_status' });\r\n    state.isConnected = true;\r\n    state.reconnectAttempts = 0;\r\n    return true;\r\n  } catch (error) {\r\n    console.warn('Connection error:', error);\r\n    state.isConnected = false;\r\n    updateStatus('Connection lost. Trying to reconnect...');\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction cleanup() {\r\n  cleanupWorker();\r\n  if (state.mediaRecorder?.state === 'recording') {\r\n    state.mediaRecorder.stop();\r\n  }\r\n}\r\n"],"names":["state","isConnected","reconnectAttempts","mediaRecorder","audioChunks","worker","elements","recording","wasmPath","chrome","runtime","getURL","audioContext","audioWorklet","safeString","input","undefined","String","documentReady","Promise","resolve","document","readyState","window","addEventListener","initializeUI","doc","chatInput","getElementById","sendButton","chatMessages","recordButton","statusDiv","transcriptionDiv","logMessages","missingElements","Object","entries","filter","_","value","map","key","length","Error","JSON","stringify","handleRecordClick","handleSendClick","handleInputChange","error","console","toggleRecording","catch","updateStatus","message","text","trim","sendMessage","addMessage","disabled","addLogEntry","type","args","entry","createElement","className","safeArgs","arg","textContent","join","appendChild","scrollTo","scrollHeight","then","log","all","initASR","checkConnection","checkModelStatus","cleanup","onMessage","addListener","sender","sendResponse","updateTranscription","originalConsole","info","safeText","currentInput","content","isUser","messageDiv","workerURL","Worker","name","reject","timeout","setTimeout","cleanupWorker","onmessage","event","data","clearTimeout","enableMicButton","onerror","postMessage","modelPath","disableMicButton","stream","navigator","mediaDevices","getUserMedia","audio","channelCount","sampleRate","autoGainControl","noiseSuppression","echoCancellation","AudioContext","webkitAudioContext","mimeType","MediaRecorder","isTypeSupported","audioBitsPerSecond","ondataavailable","size","push","onstop","audioBlob","Blob","arrayBuffer","audioBuffer","decodeAudioData","channelData","getChannelData","some","x","isFinite","start","querySelector","classList","add","stop","tracks","getTracks","forEach","track","remove","errorMessage","terminate","warn"],"sourceRoot":""}